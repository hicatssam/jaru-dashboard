<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ุชูุงุตูู ุงูุทูุจุงุช - ุงูุฌุฑู | Order Details</title>
<style>
/* [ููุณ ุงูู CSS ุชุจุนู ุจุงูุถุจุท ุจุฏูู ุชุบููุฑ] */
</style>
</head>
<body>

<header>
<img src="images/logo.svg.jpg" alt="Al Jarou Logo">
<h1 id="page-title">ุชูุงุตูู ุงูุทูุจุงุช - ุงูุฌุฑู | Order Details</h1>
<button class="lang-toggle" onclick="toggleLang()">English</button>
</header>

<div class="container">
<h2 id="latest-title">ุฃุญุฏุซ 3 ุทูุจุงุช | Latest 3 Orders</h2>
<div class="card-orders" id="latest-orders"></div>

<h2 id="all-title">ุฌููุน ุงูุทูุจุงุช | All Orders</h2>
<button id="exportExcelBtn">ุชุตุฏูุฑ Excel</button>
<button id="deleteAllBtn">ุญุฐู ูู ุงูุทูุจุงุช</button>

<table>
<thead>
<tr>
<th id="th-customer">ุงูุฒุจูู | Customer</th>
<th id="th-orders">ุงูุทูุจุงุช | Orders</th>
<th id="th-total">ุงููุจูุบ | Total</th>
<th id="th-date">ุงูุชุงุฑูุฎ | Date</th>
<th id="th-payment">ุทุฑููุฉ ุงูุฏูุน | Payment</th>
<th id="th-payment-status">ุญุงูุฉ ุงูุฏูุน | Payment Status</th>
<th id="th-status">ุงูุญุงูุฉ | Status</th>
<th>ุฅุฌุฑุงุกุงุช | Actions</th>
</tr>
</thead>
<tbody id="table-orders"></tbody>
</table>
</div>

<footer>
<p id="footer-text">&copy; 2025 Al Jarou. ุฌููุน ุงูุญููู ูุญููุธุฉ. | All rights reserved.</p>
</footer>

<!-- Alert -->
<div id="alertOverlay" class="alert-overlay">
  <div class="alert-box">
    <div style="font-size:50px; color:#f44336;">โ๏ธ</div>
    <h3 id="alertText">ูู ุฃูุช ูุชุฃูุฏุ</h3>
    <div style="margin-top:20px;">
      <button id="confirmBtn"></button>
      <button id="cancelBtn"></button>
    </div>
  </div>
</div>

<!-- โ ุฅุถุงูุฉ ุงูุตูุช -->
<audio id="orderSound" src="confirm.mp3" preload="auto"></audio>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEsjPeY7773MQeSyiL6M1n4RHRl5TGAyk",
  authDomain: "jaru-drinks.firebaseapp.com",
  projectId: "jaru-drinks",
  storageBucket: "jaru-drinks.appspot.com",
  messagingSenderId: "317969024088",
  appId: "1:317969024088:web:d99f66953f06572779f62d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let orders = [];
let lastOrderIds = [];
let currentLang = 'ar';
const orderSound = document.getElementById("orderSound");

/* ---- [ููุณ ุฏูุงู ุงูุชุฑุฌูุฉ ูุงูู renderOrders ูุงูู updatePaymentStatus ูุงูู deleteOrder ุฅููู ุนูุฏู] ---- */

/* ๐ ุฌูุจ ุงูุจูุงูุงุช ูู Firestore */
db.collection("orders").onSnapshot(snapshot => {
  const newOrders = snapshot.docs.map(doc => {
    const data = doc.data();
    return {
      id: doc.id,
      name: data.customerName,
      drinksOrder: data.drinksOrder,
      total: data.totalPrice,
      date: data.date,
      time: data.time,
      paymentMethod: data.paymentMethod || 'Cash',
      paymentStatus: data.paymentStatus || 'unpaid',
      status: data.status || 'confirmed'
    };
  });

  const newIds = newOrders.map(o => o.id);
  const addedOrders = newIds.filter(id => !lastOrderIds.includes(id));

  if (addedOrders.length > 0 && lastOrderIds.length > 0) {
    orderSound.currentTime = 0;
    orderSound.play().catch(err => console.log("Autoplay blocked:", err));
  }

  orders = newOrders;
  lastOrderIds = newIds;
  renderOrders();
});

/* โ ุชุตุฏูุฑ Excel */
document.getElementById('exportExcelBtn').addEventListener('click', () => {
  const table = document.querySelector('table');
  if (!table) return alert("ุงูุฌุฏูู ุบูุฑ ููุฌูุฏ!");
  const clone = table.cloneNode(true);
  clone.querySelectorAll('select, button').forEach(el => el.remove());
  const wb = XLSX.utils.table_to_book(clone, { sheet: "Orders" });
  XLSX.writeFile(wb, 'Orders.xlsx');
});
</script>
</body>
</html>
